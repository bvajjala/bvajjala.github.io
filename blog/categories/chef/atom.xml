<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Chef | Balaji Vajjala's Blog]]></title>
  <link href="http://bvajjala.github.io/blog/categories/chef/atom.xml" rel="self"/>
  <link href="http://bvajjala.github.io/"/>
  <updated>2014-04-17T12:44:58-04:00</updated>
  <id>http://bvajjala.github.io/</id>
  <author>
    <name><![CDATA[Balaji Vajjala]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Creating immutable servers with chef and docker.io]]></title>
    <link href="http://bvajjala.github.io/blog/2013/09/07/creating-immutable-servers-with-chef-and-docker-dot-io/"/>
    <updated>2013-09-07T18:18:00-04:00</updated>
    <id>http://bvajjala.github.io/blog/2013/09/07/creating-immutable-servers-with-chef-and-docker-dot-io</id>
    <content type="html"><![CDATA[<p>Building applications in a <a href="http://docker.io">docker.io</a> Dockerfile is relatively simple,  but sometimes you want to just install the application exactly as you would normally via already built chef cookbooks.   Turns out this is actually pretty simple.</p>

<p>The first thing you&rsquo;ll need to do is build a container with chef-client and berkshelf installed.   You can grab the one I&rsquo;ve built by running <code>docker pull paulczar/chef-solo</code> or build one youself from a <code>Dockerfile</code> that looks a little something like the following&hellip;</p>

<!--more-->


<h3>Creating a docker.io container with chef and berkshelf</h3>

<p>``` ruby Dockerfile</p>

<h1>DOCKER-VERSION 0.5.3</h1>

<p>FROM ubuntu:12.10
MAINTAINER Paul Czarkowski &ldquo;<a href="&#109;&#x61;&#105;&#x6c;&#x74;&#111;&#58;&#112;&#x61;&#x75;&#108;&#64;&#112;&#x61;&#x75;&#108;&#x63;&#x7a;&#x2e;&#x6e;&#x65;&#116;">&#112;&#x61;&#x75;&#108;&#64;&#112;&#x61;&#x75;&#x6c;&#x63;&#122;&#46;&#110;&#x65;&#116;</a>&rdquo;</p>

<p>RUN apt-get -y update
RUN apt-get -y install curl build-essential libxml2-dev libxslt-dev git
RUN curl -L <a href="https://www.opscode.com/chef/install.sh">https://www.opscode.com/chef/install.sh</a> | bash
RUN echo &ldquo;gem: &mdash;no-ri &mdash;no-rdoc&rdquo; > ~/.gemrc
RUN /opt/chef/embedded/bin/gem install berkshelf
```</p>

<p><em>you&rsquo;ll notice I&rsquo;m using the embedded chef ruby to install the berkshelf gem,  this is a handy shortcut to avoid messing around with random ruby versions from your distributions packaging.</em></p>

<p>run <code>$ docker build -t paulczar/chef-solo .</code> to build a usable docker container from the above <code>Dockerfile</code>.</p>

<h3>Using chef-solo and berkshelf to build an application in a docker.io container</h3>

<p>My <a href="https://github.com/paulczar/docker-chef-solo">example application</a> will install <code>Kibana3</code> to your docker container.   I&rsquo;ll step through how it works below.</p>

<h4>Chef-Solo</h4>

<p>To run <code>chef-solo</code> successfully we require two files.   <code>solo.rb</code> to set up file locations, and `solo.json' to set up the json / run list required for your application.</p>

<p>``` ruby chef.rb
root = File.absolute_path(File.dirname(<strong>FILE</strong>))</p>

<p>file_cache_path root
cookbook_path root + &lsquo;/cookbooks&rsquo;
```</p>

<p>``` json chef.json
{
  &ldquo;kibana&rdquo;: {</p>

<pre><code>"webserver_listen": "0.0.0.0"
</code></pre>

<p>  },
  &ldquo;run_list&rdquo;: [</p>

<pre><code>"recipe[kibana::default]"
</code></pre>

<p>  ]
}
```</p>

<h4>Berkshelf</h4>

<p>To run <code>berkshelf</code> we need to build a Berksfile which contains a list of all the chef cookbooks required for the applocation.   Berkshelf will download these cookbooks to a local directory which will be usable by chef-solo.</p>

<p>``` ruby Berksfile
site :opscode</p>

<p>cookbook &lsquo;build-essential&rsquo;
cookbook &lsquo;apache2&rsquo;
cookbook &lsquo;git&rsquo;
cookbook &lsquo;kibana&rsquo;, github: &lsquo;lusis/chef-kibana&rsquo;
cookbook &lsquo;nginx&rsquo; , github: &lsquo;opscode-cookbooks/nginx&rsquo;
```</p>

<p><em>You can see some of the cookbooks are being pulled from the opscode repository,  whereas others are being pulled directly from github.</em></p>

<h4>Dockerfile</h4>

<p>All that&rsquo;s left now is to create a Dockerfile that will bring it all together.</p>

<p>``` ruby Dockerfile</p>

<h1>DOCKER-VERSION 0.5.3</h1>

<p>FROM paulczar/chef-client
MAINTAINER Paul Czarkowski &ldquo;<a href="&#109;&#x61;&#x69;&#x6c;&#116;&#111;&#x3a;&#x70;&#x61;&#117;&#108;&#64;&#x70;&#x61;&#x75;&#x6c;&#99;&#122;&#46;&#110;&#101;&#116;">&#x70;&#x61;&#117;&#108;&#x40;&#112;&#x61;&#117;&#108;&#x63;&#122;&#x2e;&#x6e;&#101;&#x74;</a>&rdquo;</p>

<p>RUN apt-get -y update
ADD . /chef
RUN cd /chef &amp;&amp; /opt/chef/embedded/bin/berks install &mdash;path /chef/cookbooks
RUN chef-solo -c /chef/solo.rb -j /chef/solo.json
RUN echo &ldquo;daemon off;&rdquo; >> /etc/nginx/nginx.conf</p>

<p>CMD [&ldquo;nginx&rdquo;]
```</p>

<p>Run <code>$ docker build -t demo/kibana3 .</code> to build your application.</p>

<p>It will add the local files ( <code>solo.rb</code>, <code>solo.json</code>, <code>Berksfile</code> ) to /chef in the server and then call berkshelf to download the cookbooks and chef-solo to install your application.   Finally it will give <code>nginx</code> a directive to run in the foreground so that we don&rsquo;t have to do any sneaky prcess control to get it to work with the way <code>docker.io</code> runs processes.</p>

<p>To run the resultant <code>docker.io</code> container you simply need to run <code>$ docker run -d -p 80 demo/kibana3</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Installing Chef Server - On CnetOs 5.8]]></title>
    <link href="http://bvajjala.github.io/blog/2012/12/30/installing-chef-server-on-cnetos-5-dot-8/"/>
    <updated>2012-12-30T01:51:00-05:00</updated>
    <id>http://bvajjala.github.io/blog/2012/12/30/installing-chef-server-on-cnetos-5-dot-8</id>
    <content type="html"><![CDATA[<p><img class="left" src="/assets/images/Opscode_chef_logo.png" title="&lsquo;Chef Logo&rsquo;" > Following the Fuse day (#6) and the very poor documentation and the amount of bugs found in the Chef Solo cookbooks for the Chef OSS server, I put together a set of script which will attempt to clear all the clutter around installing a Chef OSS server.</p>

<p>There is a <a href="https://github.com/tikalk/chef-server-install">Git repository on git hub</a> which will install Chef Server on CentOS 5.8 &amp; 6 and I will be adding support for Ubuntu in the near future (its in the works), there is no magic here just a fair amount of trial and error which led me to automate it &ndash; it just was too much time to do manually over and over again &hellip;</p>

<p>During my attempt I was planning on using Chef-Solo to do the work based on <a href="http://wiki.opscode.com/display/chef/Installing+Chef+Server+using+Chef+Solo">this wiki page</a> but there were so many bugs in it which led me to user rble repository.</p>

<!-- more -->


<p>So what this script does ?</p>

<ol>
<li>It requires you to be root</li>
<li>It will add the required repositories</li>
<li>Install ruby via rvm (my personal preference)</li>
<li>Install chef server via rpm</li>
</ol>


<p>see: <a href="https://github.com/tikalk/chef-server-install">https://github.com/tikalk/chef-server-install</a></p>

<p>Enjoy, and I would like to here your feedback.</p>

<p>For the brave guys who do not want to read and just do it &hellip; (it takes ~30 minuets depending on your internet connection)</p>

<p><strong><em>git clone </em></strong>**_<a href="https://github.com/tikalk/chef-server-install.git_**">https://github.com/tikalk/chef-server-install.git_**</a></p>

<p><strong><em>cd ./chef-server-install &amp;&amp; setup.sh all</em></strong></p>

<blockquote></blockquote>

<hr />
]]></content>
  </entry>
  
</feed>
