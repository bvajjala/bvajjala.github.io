<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: RabbitMQ | Balaji Vajjala's Blog]]></title>
  <link href="http://bvajjala.github.io/blog/categories/rabbitmq/atom.xml" rel="self"/>
  <link href="http://bvajjala.github.io/"/>
  <updated>2014-04-14T14:20:52-04:00</updated>
  <id>http://bvajjala.github.io/</id>
  <author>
    <name><![CDATA[Balaji Vajjala]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[RabbitMQ, ActiveMQ, ZeroMQ, HornetQ]]></title>
    <link href="http://bvajjala.github.io/blog/2012/12/15/rabbitmq-activemq-zeromq-hornetq/"/>
    <updated>2012-12-15T07:00:00-05:00</updated>
    <id>http://bvajjala.github.io/blog/2012/12/15/rabbitmq-activemq-zeromq-hornetq</id>
    <content type="html"><![CDATA[<p><em>Warning</em>: In this post I&rsquo;m going to compare <a href="http://www.rabbitmq.com/">RabbitMQ</a>, <a href="http://www.zeromq.org/">ZeroMQ</a>, <a href="http://activemq.apache.org/">ActiveMQ</a>, and <a href="http://www.jboss.org/hornetq">HornetQ</a>. The basis of the comparison is not the performance, or the scalability, or any other serious feature. The comparison is done <em>purely</em> based on the popularity of those systems. Therefore, if you came here to see some performance metrics, you will be disappointed — there is none in this post.</p>

<p><em>Note</em>: To calculate popularity, I&rsquo;m going to use MongoDB and Python, so if you don&rsquo;t care about message brokers, but you want to see some examples of MongoDB scripts, this post might be interesting to you.</p>

<!-- more -->


<h2>Popularity</h2>

<p>What is the best messaging system out there? If you read my blog regularly, you probably know my biased answer. But to give an objective answer, we have to compare the candidates based on some criteria. There are many possible criteria, some of which are more relevant to your project than the others. One of them is how popular the candidate solutions are. In other words, if you choose a message broker and then you encounter a problem, how easy would it be to solve it? Is there anybody who can help you? One way to find it out is to check how many people are interested in the same solution. And the obvious way to do it is to ask Google.</p>

<p>Here is the Google trend graph for the last five years. It turns out, my personal preferences coincide with the public interest.</p>

<div class="separator" style="clear: both; text-align: center;"><script type="text/javascript" src="http://bvajjala.github.io//www.google.ca/trends/embed.js?hl=en-US&q=activemq,+rabbitmq,+zeromq,+hornetq&date=1/2008+60m&cmpt=q&content=1&cid=TIMESERIES_GRAPH_AVERAGES_CHART&export=5&w=800&h=330"></script></div>


<p>At this point I can stop and say &ldquo;Well, you see who&rsquo;s the winner&rdquo;. There are 5 times more people interested in RabbitMQ than HornetQ, so if you bet on Rabbit you have more chances to get the help from your fellow programmers, if you need to.</p>

<p>But before we make the final decision, I want to hear another opinion about the popularity of our candidates. Where do people go nowadays when they have software related problems? Right, they go to…</p>

<h2>StackOverflow</h2>

<p>The best thing about StackOverflow is their <a href="http://api.stackoverflow.com/1.0/usage">REST API</a>. For our purposes we need two API queries: get all <a href="http://api.stackoverflow.com/1.1/usage/methods/search">questions by a tag</a>, and get all <a href="http://api.stackoverflow.com/1.1/usage/methods/question-answers">answers</a> for the question. In fact, the second one is optional. Even the first query alone can give us most of what we want to know:</p>

<ul>
<li>how many questions have been posted for every candidate on our list?</li>
<li>how many answers did those questions receive?</li>
<li>how many answers were accepted?</li>
<li>how many questions and answers were marked useful?</li>
</ul>


<p>When we get all the numbers, we should know what people are actually using. We can also check if there is any correlation between Google data and StackOverflow.</p>

<p>So how do we proceed? We cannot use API directly to run analytics, because we would quickly exhaust the daily quota. What we can do is to fetch the data, save it locally, and run analytics against the local data. Here is another good thing about StackOverflow API: it comes in JSON format. What is the best way to analyze JSON data? Obviously, saving it in a JSON-oriented database that supports aggregated queries. And that&rsquo;s where MongoDB comes into play.</p>

<p><a href="https://gist.github.com/4276136#file-questions-py">Here</a> is the Python script that downloads all the questions for the specified tags from StackOverflow, and saves the results in the local MongoDB instance. I chose Python because I want to draw some graphs later, which is easy to do in Python. Plus, it&rsquo;s a simple and expressive language.</p>

<p>After we run this script, we get all the questions we need in our database. The next step is to get all the answers for those questions. <a href="https://gist.github.com/4276136#file-answers-py">Here</a> is the script that does exactly that.</p>

<p>Depends on how many questions we have saved on the first step, there might be quite a lot of queries to run to get all the answers. With my second script I exceeded the daily quota, so I had to wait for the next day to get the rest of the answers.</p>

<p>Now, when we have all the data, let&rsquo;s take a look how we can use it. Here is a typical StackOverflow record. I highlighted the fields that might be useful for our analysis.</p>

<pre>{
     "_id" : 269363,
     <font color="#0000FF">"accepted_answer_id"</font> : 290764,
     <font color="#0000FF">"answer_count" : 4</font>,
     "answers" : [
          ...
          {
               "view_count" : 0,
               "answer_comments_url" : "/answers/303710/comments",
               "answer_id" : 303710,
               "title" : "ActiveMQ .net client locks up",
               "community_owned" : false,
               "down_vote_count" : 0,
               "last_activity_date" : 1317300099,
               "creation_date" : 1227135282,
               "score" : 1,
               <font color="#0000FF">"up_vote_count" : 1</font>,
               "owner" : {
                    "display_name" : "HitLikeAHammer",
                    <font color="#0000FF">"reputation" : 1152</font>,
                    "user_id" : 35165,
                    "user_type" : "registered",
                    "email_hash" : "584cd9905db85f744e7e96740b11b7c0"
               },
               "accepted" : false,
               "last_edit_date" : 1317300099,
               "question_id" : 269363
          },
          ...
     ],
     "community_owned" : false,
     "creation_date" : 1225989513,
     "down_vote_count" : 0,
     "favorite_count" : 1,
     "last_activity_date" : 1317300112,
     "owner" : {
          "display_name" : "HitLikeAHammer",
          "reputation" : 1152,
          "user_id" : 35165,
          "user_type" : "registered",
          "email_hash" : "584cd9905db85f744e7e96740b11b7c0"
     },
     "question_answers_url" : "/questions/269363/answers",
     "question_comments_url" : "/questions/269363/comments",
     "question_id" : 269363,
     "question_timeline_url" : "/questions/269363/timeline",
     "score" : 1,
     <font color="#0000FF">"tags" : [
          ".net",
          "activemq"
     ]</font>,
     "title" : "ActiveMQ .net client locks up",
     <font color="#0000FF">"up_vote_count" : 1</font>,
     "view_count" : 1183
}</pre>


<p>First of all, we want to know how many questions are posted for each messaging system from our list. Here is the MongoDB query for that. The first snippet is a query, the second is the result.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Number of questions </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">questions</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">questions</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">])[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">result</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">1039</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">988</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">373</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">185</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The next query is to get the total number of answers by tag</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Number of answers </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">answers</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$answer_count&#39;</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">answers</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">])[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">result</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">1382</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">1322</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">572</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">227</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>It seems that the number of answers is proportional to the number of questions. With MongoDB we can quickly verify it.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Answers to questions ratio </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">answers</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$answer_count&#39;</span><span class="p">},</span> <span class="nx">questions</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$project</span><span class="o">:</span><span class="p">{</span><span class="nx">answers</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">questions</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">ratio</span><span class="o">:</span><span class="p">{</span><span class="nx">$divide</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;$answers&#39;</span><span class="p">,</span> <span class="s1">&#39;$questions&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">ratio</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">])[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">result</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">572</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">373</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.5335120643431635</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">1322</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">988</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.3380566801619433</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">1382</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">1039</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.3301251203079885</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">227</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">185</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.227027027027027</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Indeed, the answers/question ratio is almost the same for every tag. That means we can use just the number of questions for our analysis.</p>

<p>Here is the query that calculates the number of <em>accepted</em> answers by tag. Again, it correlates fairly well with the total number of answers and questions.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Number of accepted answers </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">accepted_answer_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$ne</span><span class="o">:</span><span class="kc">null</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">accepted_answers</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">accepted_answers</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">])[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">result</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;accepted_answers&quot;</span> <span class="o">:</span> <span class="mi">531</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;accepted_answers&quot;</span> <span class="o">:</span> <span class="mi">500</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;accepted_answers&quot;</span> <span class="o">:</span> <span class="mi">221</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;accepted_answers&quot;</span> <span class="o">:</span> <span class="mi">94</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The next query is more interesting. It calculates the number of question up-votes by tag. In other words, it shows the number of <em>useful</em> questions. If we divide it by the total number of questions, we should see which messaging system has bigger rate of useful questions than others</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Number of useful questions </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">upvotes</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$up_vote_count&#39;</span><span class="p">},</span> <span class="nx">questions</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$project</span><span class="o">:</span><span class="p">{</span><span class="nx">upvotes</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">questions</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">ratio</span><span class="o">:</span><span class="p">{</span><span class="nx">$divide</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;$upvotes&#39;</span><span class="p">,</span> <span class="s1">&#39;$questions&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">ratio</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">])[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">result</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">1078</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">373</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">2.8900804289544237</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">1864</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">988</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.8866396761133604</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">1459</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">1039</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.4042348411934553</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">233</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">185</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.2594594594594595</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Interesting. The ZeroMQ users seem to ask more useful questions than the users of other brokers.</p>

<p>Let&rsquo;s do the same analysis for the answers. Here is the query that calculates the number of answer up-votes by tag.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Number of useful answers </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$answers&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">question</span><span class="o">:</span><span class="s1">&#39;$_id&#39;</span><span class="p">,</span> <span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span> <span class="nx">upvotes</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$answers.up_vote_count&#39;</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$_id.tag&#39;</span><span class="p">,</span> <span class="nx">upvotes</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$upvotes&#39;</span><span class="p">},</span> <span class="nx">questions</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$project</span><span class="o">:</span><span class="p">{</span><span class="nx">upvotes</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">questions</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">ratio</span><span class="o">:</span><span class="p">{</span><span class="nx">$divide</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;$upvotes&#39;</span><span class="p">,</span> <span class="s1">&#39;$questions&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">ratio</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">])[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">result</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">1469</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">338</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">4.346153846153846</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">2437</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">858</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">2.84032634032634</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">2199</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">902</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">2.4379157427937916</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">262</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">156</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.6794871794871795</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Again, ZeroMQ users post more useful answers than others.</p>

<p>To complete the picture of typical users, let&rsquo;s run the following query that calculates an average reputation of people that post answers</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Reputation of respondents </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$answers&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">question</span><span class="o">:</span><span class="s1">&#39;$_id&#39;</span><span class="p">,</span> <span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span> <span class="nx">reputation</span><span class="o">:</span><span class="p">{</span><span class="nx">$avg</span><span class="o">:</span><span class="s1">&#39;$answers.owner.reputation&#39;</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$_id.tag&#39;</span><span class="p">,</span> <span class="nx">reputation</span><span class="o">:</span><span class="p">{</span><span class="nx">$avg</span><span class="o">:</span><span class="s1">&#39;$reputation&#39;</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">reputation</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">])[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">result</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;reputation&quot;</span> <span class="o">:</span> <span class="mf">10088.29552338687</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;reputation&quot;</span> <span class="o">:</span> <span class="mf">7298.7539383380845</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;reputation&quot;</span> <span class="o">:</span> <span class="mf">6082.172231934734</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;reputation&quot;</span> <span class="o">:</span> <span class="mf">3472.9658119658116</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Wow. ZeroMQ users not only ask more useful questions and give useful answers, they also have higher reputation on average in the StackOverflow community.</p>

<p>As a final exercise, I want to build a graph of question distribution over time. After all, ActiveMQ is the oldest broker, and it might have got more questions just because it was launched first. For this purpose I created <a href="https://gist.github.com/4276136#file-trends-py">this</a> Python script that uses amazing <a href="http://matplotlib.org/gallery.html">matplotlib</a> library. And here is the result for the last 60 months</p>

<p><img class="center" src="/images/posts/mom-trends-so.png"></p>

<p>It shows that the proportion of interest in different massaging systems was approximately the same all the time. Furthermore, the StackOverflow statistics of this year correlates well with the Google statistics.</p>

<h2>Conclusion</h2>

<ol>
<li><p>RabbitMQ and ActiveMQ are very popular. If you choose one of them for your messaging infrastructure, you shouldn&rsquo;t have any problem with the community support. HornetQ might be a good message broker but it definitely lacks the community interest. Finally, as I <a href="/2012/11/12/pycon-canada-2012/#learn">suspected</a> before, ZeroMQ is worth looking at. There are bunch of smart and helpful people in ZeroMQ community.</p></li>
<li><p>MongoDB is really nice! Its aggregation framework is powerful and easy to use. It was fun playing with it.</p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SpringOne2GX 2010]]></title>
    <link href="http://bvajjala.github.io/blog/2010/10/31/springone2gx-2010/"/>
    <updated>2010-10-31T08:00:00-04:00</updated>
    <id>http://bvajjala.github.io/blog/2010/10/31/springone2gx-2010</id>
    <content type="html"><![CDATA[<p>Last week I attended SpringOne2GX conference in Chicago, the main event in Spring/Groovy/Grails community. Here I want to post my brief review of this conference.</p>

<h3>First impressions</h3>

<p>The hotel (Westin Lombard) was nice and clean. Internet: there were 2 wireless networks and one cable — everything was free and worked pretty well, signal was good in almost all rooms. The conference reception was well organized — every participant received bunch of souvenirs and special edition of NFJS magazine. I saw hundreds of smiling and happy people of different ages and different outfits. Most of them with Macs. Most of them know each other. The food was fantastic, especially dinner with wine and beer.</p>

<h2>Day 1</h2>

<p>The first day was mostly introduction and orientation. There was only one talk on the schedule.</p>

<h3>Rod Johnson — Keynote (<a href="http://www.infoq.com/presentations/SpringOne-2GX-2010-Keynote">video</a>)</h3>

<p>I thought Spring was initially created 7 years ago but the oldest class in the source tree is dated by January 17, 2001, so Spring is actually almost 10 years old. Because of the anniversary the main theme of the presentation was: <em>Where Spring goes in the next decade</em>.</p>

<p>Since the core framework is well crafted already, the focus will be on the integration and making Spring portfolio as a platform for applications. There are three key values in Spring — <em>portability</em>, <em>productivity</em>, and <em>innovation</em> — and the platform will be built along those dimensions.</p>

<h4>Portability</h4>

<p>In the past SpringSource made a good job by providing a framework that makes Java applications easily portable across different application servers. The goal for the next decade is to expand the same portability to the cloud — Google AppEngine, vFabric, vmforce, etc.</p>

<h4>Productivity</h4>

<p>As we all know the ultimate reason of the Spring existence is to make the life of application developer easier, our work is more productive. The framework hides the low-level boilerplate, and provides well defined abstractions. In the next year there will be several features added to the Spring portfolio. Rod mentioned some of them:</p>

<ul>
<li>Seamless GWT integration</li>
<li>Database reverse engineering with roundtripping support in Spring Roo 1.1. You will be able to generate the domain object tree based on your database schema, and it will be updated every time you change the database.</li>
<li>Spring Payment Services project with Visa integration.</li>
</ul>


<p>Another aspect of productivity is a tool suite, where Spring provides STS. Rod invited Christian Dupuis on the stage, where he demoed how to developed Grails applications in STS. If you are a Grails developer you should definitely take a look at the latest version of STS — it will increase your productivity significantly.</p>

<h4>Innovation</h4>

<p>There will be several new projects released in the Spring portfolio soon:</p>

<ul>
<li>Spring Social — application abstraction for social networks.</li>
<li>Spring Mobile — platform for multi-device applications.</li>
<li>Spring-AMQP — API for integration with RabbitMQ.</li>
<li>Spring Data — API to work with NoSQL databases, in particular Neo4J support in Spring Roo.</li>
</ul>


<p>Keith Donald demoed <a href="http://greenhouse.springsource.org">GreenHouse</a> project and corresponding <a href="http://itunes.apple.com/us/app/greenhouse/id395862873">iPhone app</a>. This is a reference implementation of Spring Mobile and Spring Social, and this app was really really useful during the conference when I needed to check the schedule and find the room.</p>

<p>At the end of the presentation Rod introduced, and Mik Kersten demoed, the next big thing — <em>Code2Cloud</em>. It&rsquo;s basically a tool that allows you to keep and manage your entire development environment in the cloud: the running app, the source code, the issue tracker, and the build server. Everything is in the cloud and configured by mouse click. It looks cool, and it definitely will be a buzz word in the next year, but I&rsquo;m not sure if many people will use it. We&rsquo;ll see.</p>

<h2>Day 2</h2>

<p>I&rsquo;m going to write only about technical sessions I attended.</p>

<h3>J&uuml;rgen H&ouml;ller — What&rsquo;s new in Spring Framework 3.1? (<a href="http://www.infoq.com/presentations/Spring-3.0-3.1-3.2">video</a>)</h3>

<p>That was one of the best talks of this conference: technical, right to the point, with well-wrtten slides, and personal charm of the presenter. Despite the number 3.1 in the title, J&uuml;rgen actually covered three versions of Spring framework: 3.0, 3.1, and 3.2. I&rsquo;m going to briefly mention the interesting features, and if you want more details you can check the excellent on-line documentation.</p>

<h4>Spring 3.0</h4>

<ul>
<li><p>Custom annotations. You can create your own annotation by combining multiple existing annotations in one group. Spring automatically detects your annotation during the application context startup, and no special configuration is required. This is a very handy feature, especially when you copy-paste the same annotation group over and over again.</p></li>
<li><p>Configuration classes and annotated factory methods. If you annotate a method with @Bean annotation Spring framework will make the output of the method a Spring bean. There are some other annotations supported, e.g. @Lazy.</p></li>
<li><p>Standardized annotations. Spring now supports JSR-330 @Inject, JSR-250 @ManagedBean, and EJB 3.x @TransactionAnnotation.</p></li>
<li><p>EL++. Expression language can be used now in bean definitions inside appcontext XML, and also in component annotations. Very powerful feature.</p></li>
<li><p>REST support. Spring provides RestTemplate for client code, @PathVariable annotation, and special view resolvers on the server side. It&rsquo;s very interesting topic — check the documentation for details.</p></li>
<li><p>Declarative model validation. You can specify data constraints right in your code by using annotations — very similar to what you have in GORM.</p></li>
<li><p>Improved scheduling. New namespace, and @Scheduled and @Async annotations makes your appcontext smaller and more readable.</p></li>
</ul>


<p>If you follow Spring releases, you probably use some or most of these features already. Now let&rsquo;s see what Spring 3.1 brings to us.</p>

<h4>Spring 3.1</h4>

<ul>
<li><p>Environment profiles for beans. Similar to Maven profiles but works in runtime. The idea here is to create a single deployment unit for all environments and enable certain Spring beans for specific environment. I can&rsquo;t wait to try this feature in our enterprise project.</p></li>
<li><p>Cache abstraction. After 5 years of hibernation this feature is finally implemented. Spring provides an API to work with distributed cache, in particular in cloud environments. There will be adapters for most popular cache implementations, such as EhCache, GemFire, Coherence.</p></li>
<li><p>Conversation management, or how J&uuml;rgen calls it HttpSession++. It&rsquo;s basically an extension of HttpSession shared across multiple browsers and window tabs. Looks very interesting.</p></li>
<li><p>Enhanced Groovy support.</p></li>
<li><p><code>c:</code> namespace, which is a shortcut for <code>&lt;constructor-arg&gt;</code>, analogous to <code>p:</code> namespace for properties. Small feature that makes your appcontext consistent and more readable.</p></li>
</ul>


<h4>Spring 3.2</h4>

<p>Java SE 7 support, JDBC 4.1, support for fork-join framework, general focus on concurrent programming.</p>

<h3>Jeff Brown — GORM inside and out</h3>

<p>This talk was also good. I worked a bit with GORM before, and had an idea how it&rsquo;s implemented, but it was useful to hear more details from one of its developers.</p>

<p>Jeff started with the background of GORM, the complexity of Hibernate and JPA, and how GORM solves this problem following convention-over-configuration and sensible defaults strategies. He showed how to model the domain objects, what happens behind the scene when you link objects together, how to specify uni- and bi-directional relationships, and how to change default collection implementation in case of one-to-many relationship.</p>

<p>During the presentation he was switching back and forth between sides and terminal, so it was easy to follow and understand the evolution of the sample application. He explained how to introduce various constraints into the model and how Grails would validate them. One of the interesting features I didn&rsquo;t know about was how to test internationalized error messages. You don&rsquo;t need to change your locale for that, simply add <code>lang=your_language</code> parameter to the URL, and Grails will switch to that language for all subsequent requests. Pretty handy.</p>

<p>He concluded the talk by showing how dynamic finders are implemented in GORM using Groovy metaprogramming feature. Interesting part here is that you can implement similar things in your Groovy code using the same technique, basically having custom mini-GORM in your Groovy project!</p>

<h3>Venkat Subramaniam — Improving your Groovy code quality</h3>

<p>The title of this presentation was little bit misleading for me. I expected Venkat to show some Groovy specific mistakes and how to avoid them. Instead, he was talking about the errors that in most cases are equally applied to any programming language. He mentioned various code smells and explained how to fix them. If you are interested, you can download the slides from Venkat&rsquo;s <a href="http://www.agiledeveloper.com/presentations/improving_your_groovy_code_quality.zip">web site</a>.</p>

<p>He also gave an advise how to maintain the high code quality:</p>

<ul>
<li>Have a respectable colleague review your code.</li>
<li>Use code analysis tools like CodeNarc and Sonar Groovy plugin.</li>
</ul>


<p>One of the topics he covered was the usage of the <code>return</code> keyword in Groovy. That was interesting. Compare the following two functions, guess what they return, and check your answer in the console</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="kt">def</span> <span class="nf">func1</span><span class="o">()</span> <span class="o">{&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;pre&gt;&lt;code&gt;try {</span>
</span><span class='line'><span class="s">    5</span>
</span><span class='line'><span class="s">} finally {</span>
</span><span class='line'><span class="s">    return 22</span>
</span><span class='line'><span class="s">}</span>
</span><span class='line'><span class="s">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="kt">def</span> <span class="nf">func2</span><span class="o">()</span> <span class="o">{&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;pre&gt;&lt;code&gt;try {</span>
</span><span class='line'><span class="s">    5</span>
</span><span class='line'><span class="s">} finally {</span>
</span><span class='line'><span class="s">    22</span>
</span><span class='line'><span class="s">}</span>
</span><span class='line'><span class="s">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>Paul King, Guillaume Laforge — Groovy.DSLs (from: beginner, to: expert) (<a href="http://www.infoq.com/presentations/Groovy-DSLs">video</a>)</h3>

<p>This would be very nice presentation if the speakers didn&rsquo;t try to cover too much. This talk could be easily split into two: one is an overview of Groovy language and another one is DSL. Unfortunately they spent lot of time on theoretical DSL part and Groovy overview, so the practical DSL part was too short from my perspective. The good thing though is that I have slides now, so I can dig deeper into this subject at my spare time.</p>

<p>In the second part of the talk Paul and Guillaume explained which features of Groovy language make it so simple to create DSLs. Here are some of them:</p>

<ul>
<li>Static imports and import aliases.</li>
<li>Simplified collection syntax.</li>
<li>Small or no language noise.</li>
<li>Aggregating multiple method calls using &lsquo;with&rsquo; construct.</li>
<li>Closures.</li>
<li>Operator overloading.</li>
<li>Metaprogramming.</li>
</ul>


<p>In the last part speakers talked about different patterns and techniques of DSL implementations. They provided a comprehensive list of books you might want to read if you are interested in building DSLs.</p>

<h3>Adrian Colyer — Technical keynote (<a href="http://www.infoq.com/presentations/Spring-2010-Technology">video</a>)</h3>

<p>Adrian&rsquo;s talk was mostly a reiteration of Rod&rsquo;s keynote from the previous day with some technical details. He mentioned Spring Payment and Spring Data projects, bean profiles and cache support in the Spring core. He showed Spring portability in action by providing links to Spring applications deployed on <a href="http://springtravelsql.appspot.com/login">Google AppEngine</a> and <a href="http://booking-mvc.internal.vmforce.com/spring/intro">vmForce</a>.</p>

<p>Another interesting part was 20 minutes dedicated to RabbitMQ and Spring-AMQP. He even mentioned <em>Spring-Erlang</em> project which is supposed to be a convenient abstraction on top of standard Jinterface library.</p>

<p>As a continuation of innovation theme Graeme Rocher demoed GORM support for NoSQL databases. That was cool. He simply uninstalled Hibernate plugin and installed Redis plugin, without touching data model. Everything worked perfect. Right now Spring works with Redis and GemFire, but soon they are going to add support for CouchDB, Cassandra, Riak, Neo4j, and MongoDB. Another interesting thing Graeme showed was <em>grails-console</em>. It&rsquo;s a pretty nice tool, you should check it out. It allows you to interact with the Grails data storage using GORM features. Very handy.</p>

<p>Another co-presenter was Keith Donald who demoed Spring Social and Spring Mobile. He explained how OAuth works, and how interoperability with social networks was implemented in GreenHouse.</p>

<p>The keynote was concluded by Jon Travis who demoed <em>SpringInsight</em>.</p>

<h2>Day 3</h2>

<h3>Venkat Subramaniam — Functional programming in Groovy</h3>

<p>That was an excellent talk and nice start of the new conference day. Venkat explained main concepts and values of functional programming, and illustrated the theory with comprehensible examples.</p>

<p>He compared imperative and functional style of programming by showing how to implement for-loop using <code>inject</code> function in Groovy. I think it was one of the best explanations of functional folding I&rsquo;ve ever heard. He also demonstrated map and filter operations using <code>collect</code> and <code>findAll</code> methods.</p>

<p>He clarified the difference between function value and closure, and between iterative procedure and iterative process. He gave an example on how to pass closure as a parameter to simulate function object in Groovy. He also showed how to replace tail-recursion, which Groovy doesn&rsquo;t support, with <code>inject</code> method call.</p>

<p>The presentation was concluded with an example of how to use functional techniques to build DSLs in Groovy.</p>

<h3>Matthias Radestock, Mark Pollack, Mark Fisher — RabbitMQ and Spring-AMQP (<a href="http://www.infoq.com/presentations/Spring-AMQP">video</a>)</h3>

<p>If you read my blog, you know that RabbitMQ is one of my latest interests. I decided to go to this talk just to see how the creators would present their projects. It turned out to be a nice introduction to both RabbitMQ and <a href="http://www.springsource.org/spring-amqp">Spring-AMQP</a>. They explained main concepts of AMQP and how it is different from JMS. Here I want to give you some ideas which were not obvious for me when I started working with RabbitMQ.</p>

<ul>
<li>Messaging is all about decoupling, and AMQP is much more flexible than JMS in terms of publisher-consumer decomposition.</li>
<li>All resources are dynamically created and destroyed by clients — the static pre-configuration is optional.</li>
<li>Exchanges are stateless, they don&rsquo;t keep messages, they only copy and dispatch them. Queues hold the messages and deliver one message to a single client. They neither do routing nor message copying.</li>
<li>Queue never receives the same message twice.</li>
<li>If the message doesn&rsquo;t match routing key it&rsquo;s dropped.</li>
<li>Because of the open protocol, you can use all available TCP tools to monitor your message traffic.</li>
</ul>


<p>Besides AMQP implementation RabbitMQ also provides some other useful features like custom exchanges, exchange-to-exchange routing, different protocol adaptors, etc. Spring, as usual, gives you a consistent API on top of the RabbitMQ client which hides all low-level boilerplate and makes your application code more readable.</p>

<h3>Craig Walls — Developing social-ready web applications (<a href="http://www.infoq.com/presentations/Developing-Social-Ready-Web-Apps">video</a>)</h3>

<p>This presentation was about integrating your Java code with different social networks. There are three types of such integration: widgets, embedded code, REST API. Craig briefly explained first two, and then dived into REST.</p>

<p>All popular social networks provide REST API which allows you to communicate with them. For simple operations, like search, you can just use standard Spring RestTemplate class to retrieve the data. Try for example the following URLs:</p>

<ul>
<li><a href="http://api.twitter.com/1/friends/ids.xml?screen_name=ndpar">http://api.twitter.com/1/friends/ids.xml?screen_name=ndpar</a></li>
<li><a href="http://search.twitter.com/search.json?q=s2gx">http://search.twitter.com/search.json?q=s2gx</a></li>
<li><a href="https://graph.facebook.com/ndpar">https://graph.facebook.com/ndpar</a></li>
</ul>


<p>This basic approach fails though if you try to post a new message, because you have to be authorized for update operations. That&rsquo;s where OAuth comes in. The idea behind OAuth is pretty simple: instead of sharing your user-password with different clients, it uses generated tokens. This model is more flexible because if you want to revoke the permission from particular client you don&rsquo;t need to change your password and notify rest of the clients — you just remove that client&rsquo;s token from the list of authorized clients and that&rsquo;s it. The only problem with OAuth and social networks is that they support different versions of OAuth. This problem is solved by Spring Social project.</p>

<p>Spring Social offers consistent template-based API across different social providers. It basically gives you an OAuth aware RestTemplate, so you can do something like this:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">TwitterTemplate</span> <span class="n">twitter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TwitterTemplate</span><span class="o">(</span><span class="n">API_KEY</span><span class="o">,</span> <span class="n">API_SECRET</span><span class="o">,</span> <span class="n">ACCESS_TOKEN</span><span class="o">,</span> <span class="n">ACCESS_TOKEN_SECRET</span><span class="o">);</span>
</span><span class='line'><span class="n">twitter</span><span class="o">.</span><span class="na">updateStatus</span><span class="o">(&amp;</span><span class="n">ldquo</span><span class="o">;</span><span class="n">Hello</span> <span class="err">#</span><span class="n">s2gx</span> <span class="o">!&amp;</span><span class="n">rdquo</span><span class="o">;);</span>
</span><span class='line'><span class="n">twitter</span><span class="o">.</span><span class="na">retweet</span><span class="o">(</span><span class="mi">26887414177L</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>If you are in a social network business, definitely take a look at <a href="http://www.springsource.org/spring-social">Spring Social</a>.</p>

<h3>Mark Pollack, Chris Richardson — Using Spring with non-relational databases (<a href="http://www.infoq.com/presentations/Using-Spring-with-NoSQL-Databases">video</a>)</h3>

<p>Relational databases are great, right? They&rsquo;ve been with us for ages. Everybody knows how to work with them, how to build SQL statements. Every language provides ODBC library. There are bunch of frameworks that make developer&rsquo;s life easier. So why is so much buzz around NoSQL?</p>

<p>Mark and Chris started their talk highlighting some problems that exist in relational database world:</p>

<ul>
<li>Object-relational impedance mismatch. Complicated mapping of rich domain model to relational schema. Relational schema rigidity.</li>
<li>Extremely difficult/impossible to scale write operations.</li>
<li>Suboptimal performance in some cases.</li>
</ul>


<p>All these issues are addressed in NoSQL databases. Although keep in mind that it&rsquo;s not coming for free — you have to trade off ACID semantics, transactions and some other features of RDBMS. But if scalability is more important for you than consistency then NoSQL is your way to go.</p>

<p>There are tons of NoSQL databases available for you, but they all can be split into 4 categories based on their data model:</p>

<ul>
<li>Key-Value: Amazon Dynamo, Redis, Riak, Voldemort.</li>
<li>Column: Google Bigtable, HBase, Cassandra.</li>
<li>Document: CouchDB, MongoDB.</li>
<li>Graph: Neo4j, Sones, InfiniteGraph.</li>
</ul>


<p>Mark and Chris talked about each type, what their typical use cases are, and how their APIs look like. They showed examples for Redis, Cassandra, MongoDB, CouchDB and Neo4j. Then they introduced <a href="http://www.springsource.org/spring-data">Spring Data</a> project which, as everything from SpringSource, simplifies the application development and hides low-level code. Right now they support most of the popular NoSQL databases, and they plan to add more in the future.</p>

<p>The project is in active development phase, and the new contributors are welcome. So if it sounds interesting for you, go and check it out.</p>

<h2>Day 4</h2>

<h3>Hans Dockter — Gradle — a better way to build</h3>

<p>I never played with Gradle, so I was very curious to see how it looks like. According to Hans, who is the creator of this tool, Gradle is a general purpose build system with Groovy DSL interface. It&rsquo;s written in Java and provides build-in support for Java, Groovy, Scala, web and OSGi projects. It&rsquo;s a build language, so you can extend it for your own purposes if needed.</p>

<p>If you compare it with Ant, Gradle is definitely much better because it&rsquo;s more compact and flexible. It offers dependency resolution with integration with Maven and Ivy repositories. It also has some advanced features like incremental builds for custom tasks and parallel testing.</p>

<p>The only problem I had with this presentation was that Hans kept comparing Gradle with Maven. In my opinion they are not comparable. They have different philosophy if you want. All Maven &ldquo;constraints&rdquo; are imposed by design, so it makes no sense to blame Maven for them. I think Ant-Gradle comparison is more appropriate and that&rsquo;s what Hans should have emphasized.</p>

<p>Other than that the session was pretty informative, and I have a better picture of Gradle now.</p>

<h3>Brian Sletten — Groovy + The Semantic Web</h3>

<p>I had no idea what Semantic Web was. I saw this term first time on the conference schedule, so I decided to go to this talk just to educate myself. I cannot even briefly describe all the discoveries I made during this presentation because I still feel little bit overwhelmed. I just want to provide some links from Brian&rsquo;s slides that can guide you if you want to learn this concept.</p>

<ul>
<li><a href="http://en.wikipedia.org/wiki/Semantic_Web">Semantic Web</a> — article from wikipedia.</li>
<li>Formal W3C specs: <a href="http://www.w3.org/RDF/">RDF</a>, <a href="http://www.w3.org/TR/rdfa-syntax/">RDFa</a>, <a href="http://www.w3.org/2004/02/skos/">SKOS</a>, <a href="http://www.w3.org/TR/rdf-sparql-query/">SPARQL</a>, <a href="http://www.w3.org/TR/owl2-overview/">OWL</a>.</li>
<li>SPARQL <a href="http://librdf.org/query">demo</a>.</li>
<li><a href="http://www.w3.org/2007/08/pyRdfa">RDFa distiller and parser</a>. Try to feed Brian&rsquo;s test page URL (<a href="http://bosatsu.net/nfjs/test.html">http://bosatsu.net/nfjs/test.html</a>) to the distiller and see what it returns.</li>
<li><a href="http://opengraphprotocol.org">OG</a> — open graph protocol.</li>
<li><a href="http://jena.sourceforge.net">Jena</a> — Java API to work with Semantic Web.</li>
<li><a href="http://github.com/shellac/java-rdfa">Java-RDFa</a> parser.</li>
<li><a href="http://clarkparsia.com/pellet/">Pellet</a> — Java API for OWL.</li>
</ul>


<h3>Conclusion</h3>

<p>Whew! This happened to be longer review than I planned initially. If you are still with me, congratulations!</p>

<p>There were much more presentations at this conference but because of the tight schedule I had to sacrifice 80% of them. My overall impression from this conference is very positive. If you are a Spring/Groovy/Grails developer I encourage you to go to this event next year. The biggest benefit of it: <em>You start seeing the Spring as a universe</em>, not as a bunch of separate projects. You cannot get this feeling from the documentation, even if it&rsquo;s perfect as the Spring one.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Integrating RabbitMQ with ejabberd]]></title>
    <link href="http://bvajjala.github.io/blog/2010/03/31/integrating-rabbitmq-with-ejabberd/"/>
    <updated>2010-03-31T08:00:00-04:00</updated>
    <id>http://bvajjala.github.io/blog/2010/03/31/integrating-rabbitmq-with-ejabberd</id>
    <content type="html"><![CDATA[<p>ejabberd is integrated with RabbitMQ by means of <a href="http://tonyg.github.io/rabbitmq-xmpp/">mod_rabbitmq</a> gateway. If you followed my ejabberd installation <a href="/2010/02/23/get-started-with-ejabberd/">instructions</a>, you should already have mod_rabbitmq installed.</p>

<h2>Configure mod_rabbitmq</h2>

<p>Open <em>/opt/ejabberd/ejabberd/etc/ejabberd/ejabberd.cfg</em> file, find <em>modules</em> section, and add mod_rabbitmq stanza to the list</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>/opt/ejabberd/ejabberd/etc/ejabberd/ejabberd.cfg </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">{</span><span class="n">modules</span><span class="p">,</span>
</span><span class='line'> <span class="p">[</span>
</span><span class='line'>  <span class="err">&amp;</span><span class="n">hellip</span><span class="p">;</span>
</span><span class='line'>  <span class="p">{</span><span class="n">mod_rabbitmq</span><span class="p">,</span>  <span class="p">[{</span><span class="n">rabbitmq_node</span><span class="p">,</span> <span class="nv">RABBIT_NODE</span><span class="p">}]},</span>
</span><span class='line'>  <span class="err">&amp;</span><span class="n">hellip</span><span class="p">;</span>
</span><span class='line'> <span class="p">]}.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>You need to replace <em>RABBIT_NODE</em> with the real value, which you can find from the RabbitMQ process information</p>

<pre><code>$ ps -ef | grep beam
rabbitmq  8525  8142  0 16:37 pts/0    ... -sname rabbit@ubuntu ...
</code></pre>

<p>You can see my RabbitMQ node name is <em>rabbit@ubuntu</em>.</p>

<h2>Set up cookie</h2>

<p>To make RabbitMQ and ejabberd work together, they have to run in the same Erlang cluster. That means they have to use the same cookie file. If you <a href="/2010/03/14/get-started-with-rabbitmq/">installed</a> RabbitMQ from binary distribution, it uses the user&rsquo;s cookie <em>~/.erlang.cookie</em>. ejabberd, on the other hand, uses its own cookie. Let&rsquo;s replace it with the user&rsquo;s</p>

<pre><code>$ cd /opt/ejabberd/ejabberd/var/lib/ejabberd
$ rm -f .erlang.cookie
$ ln -s ~/.erlang.cookie
</code></pre>

<p>Restart ejabberd server</p>

<pre><code>$ /opt/ejabberd/ejabberd/sbin/ejabberdctl restart
</code></pre>

<h2>Add rabbit buddy to roster</h2>

<p>The rabbit&rsquo;s JID consists of two parts: exchange name and routing domain. The routing domain is a string <code>rabbitmq.EJABBERD_HOST</code> where <em>EJABBERD_HOST</em> is the host you registered in <em>ejabberd.cfg</em>. In my case the routing domain is <code>rabbitmq.jabber.ndpar.com</code>.</p>

<p>For the name you can use any exchange name available in the RabbitMQ server. I use <code>amq.fanout</code> exchange which exists in every RabbitMQ server. So I go to my IM client (Adium) and add this user to the buddies list <code>amq.fanout@rabbitmq.jabber.ndpar.com</code>.</p>

<h2>Rabbit&rsquo;s greetings</h2>

<p>To publish a message to RabbitMQ I use the same Groovy script as in the previous <a href="/2010/03/14/get-started-with-rabbitmq/">post</a></p>

<pre><code>$ ./publisher.groovy
</code></pre>

<p><img class="center" src="/images/posts/mod_rabbitmq.png"></p>

<h3>Resources</h3>

<ul>
<li>Tony Garnock-Jones' <a href="http://www.erlang-factory.com/upload/presentations/229/ErlangFactorySFBay2010-TonyGarnock-Jones.pdf">presentation slides</a> about RabbitMQ and its extensions.</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Get started with RabbitMQ]]></title>
    <link href="http://bvajjala.github.io/blog/2010/03/14/get-started-with-rabbitmq/"/>
    <updated>2010-03-14T08:00:00-04:00</updated>
    <id>http://bvajjala.github.io/blog/2010/03/14/get-started-with-rabbitmq</id>
    <content type="html"><![CDATA[<p><a href="http://www.rabbitmq.com">RabbitMQ</a> is an open-source implementation of <a href="http://en.wikipedia.org/wiki/AMQP">AMQP</a>. If you don&rsquo;t know what AMQP is, I encourage you to read about it on the official web site or the reference <a href="http://www.rabbitmq.com/how.html">page</a>. What <em>I</em> personally like in RabbitMQ/AMQP is</p>

<ul>
<li>AMQP is a free alternative to expensive TIBCO Randezvous.</li>
<li>Functionality-wise AMQP is a superset of JMS.</li>
<li>RabbitMQ is written in Erlang, which means fault-tolerance and reliability.</li>
</ul>


<p>In this short blog entry I show how to install RabbitMQ on a *nix box, and verify that it&rsquo;s working with a simple Groovy client.</p>

<!-- more -->


<h2>Installing RabbitMQ server</h2>

<p>Before installing RabbitMQ make sure you have Erlang environment set up. Run the following command and verify the output</p>

<pre><code>$ erl -version
Erlang (ASYNC_THREADS,HIPE) (BEAM) emulator version 5.10.1
</code></pre>

<p>I used to install RabbitMQ using apt-get command, which is convenient but always several versions behind. That&rsquo;s why I switched to <a href="http://www.rabbitmq.com/install-generic-unix.html">binary distribution</a> installation. So here are the installation steps</p>

<pre><code>$ sudo mkdir /opt/rabbitmq
$ sudo chown -R rabbitmq /opt/rabbitmq
$ cd /opt/rabbitmq
$ wget http://www.rabbitmq.com/releases/rabbitmq-server/v3.1.1/rabbitmq-server-generic-unix-3.1.1.tar.gz
$ tar xf rabbitmq-server-generic-unix-3.1.1.tar.gz
$ rm rabbitmq-server-generic-unix-3.1.1.tar.gz
$ ln -s rabbitmq_server-3.1.1 rabbitmq
</code></pre>

<p>Append the following lines to <em>~/.bashrc</em></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>~/.bashrc </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">RABBITMQ_HOME</span><span class="o">=</span>/opt/rabbitmq/rabbitmq
</span><span class='line'><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$RABBITMQ_HOME</span>/sbin
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Enable web admin plugin</p>

<pre><code>$ rabbitmq-plugins enable rabbitmq_management
</code></pre>

<p>Run the following command to verify server is starting</p>

<pre><code>$ rabbitmq-server

              RabbitMQ 3.1.1. Copyright (C) 2007-2013 VMware, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs: /opt/rabbitmq/rabbitmq/sbin/../var/log/rabbitmq/rabbit@beta.log
  ######  ##        /opt/rabbitmq/rabbitmq/sbin/../var/log/rabbitmq/rabbit@beta-sasl.log
  ##########
              Starting broker... completed with 6 plugins.
</code></pre>

<p>Go to <a href="http://localhost:15672">localhost:15672</a> in the browser. You should be able to login as guest/guest.</p>

<h2>Groovy client</h2>

<p>Groovy client is essentially Java client written in Groovy language. Here are the scripts for consumer and publisher in Groovy</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>consumer.groovy </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="o">&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;h1&gt;!/</span><span class="n">usr</span><span class="s">/bin/</span><span class="n">env</span> <span class="n">groovy</span><span class="o">&lt;</span><span class="s">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;p&gt;import com.rabbitmq.client.*&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="nd">@Grab</span><span class="o">(</span><span class="n">group</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">com</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="n">module</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">amqp</span><span class="o">-</span><span class="n">client</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="n">version</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="mf">3.1</span><span class="o">.</span><span class="mi">0</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;)</span>
</span><span class='line'><span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">([&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;pre&gt;&lt;code&gt;username: &#39;guest&#39;,</span>
</span><span class='line'><span class="s">password: &#39;guest&#39;,</span>
</span><span class='line'><span class="s">virtualHost: &#39;/</span><span class="err">&#39;</span><span class="o">,</span>
</span><span class='line'><span class="nl">requestedHeartbeat:</span> <span class="mi">0</span>
</span><span class='line'><span class="o">&lt;</span><span class="s">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;])</span>
</span><span class='line'><span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">(</span><span class="k">new</span> <span class="n">Address</span><span class="o">(&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">localhost</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="mi">5672</span><span class="o">))</span>
</span><span class='line'><span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">()&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;p&gt;queueName = &amp;lsquo;myQueue&amp;rsquo;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">channel</span><span class="o">.</span><span class="na">queueDeclare</span> <span class="n">queueName</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="o">[:]</span>
</span><span class='line'><span class="n">channel</span><span class="o">.</span><span class="na">queueBind</span> <span class="n">queueName</span><span class="o">,</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">amq</span><span class="o">.</span><span class="na">fanout</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">myRoutingKey</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;p&gt;def consumer = new QueueingConsumer(channel)</span>
</span><span class='line'><span class="s">channel.basicConsume queueName, false, consumer&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;pre&gt;&lt;code&gt;delivery = consumer.nextDelivery()</span>
</span><span class='line'><span class="s">println &quot;Received message: ${new String(delivery.body)}&quot;</span>
</span><span class='line'><span class="s">channel.basicAck delivery.envelope.deliveryTag, false</span>
</span><span class='line'><span class="s">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;}</span>
</span><span class='line'><span class="n">channel</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>publisher.groovy </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="o">&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;h1&gt;!/</span><span class="n">usr</span><span class="s">/bin/</span><span class="n">env</span> <span class="n">groovy</span><span class="o">&lt;</span><span class="s">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;p&gt;import com.rabbitmq.client.*&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="nd">@Grab</span><span class="o">(</span><span class="n">group</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">com</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="n">module</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">amqp</span><span class="o">-</span><span class="n">client</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="n">version</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="mf">3.1</span><span class="o">.</span><span class="mi">0</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;)</span>
</span><span class='line'><span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">([&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;pre&gt;&lt;code&gt;username: &#39;guest&#39;,</span>
</span><span class='line'><span class="s">password: &#39;guest&#39;,</span>
</span><span class='line'><span class="s">virtualHost: &#39;/</span><span class="err">&#39;</span><span class="o">,</span>
</span><span class='line'><span class="nl">requestedHeartbeat:</span> <span class="mi">0</span>
</span><span class='line'><span class="o">&lt;</span><span class="s">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;])</span>
</span><span class='line'><span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">(</span><span class="k">new</span> <span class="n">Address</span><span class="o">(&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">localhost</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="mi">5672</span><span class="o">))</span>
</span><span class='line'><span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">()&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;p&gt;channel.basicPublish &amp;lsquo;amq.fanout&amp;rsquo;, &amp;lsquo;myRoutingKey&amp;rsquo;, null, &amp;ldquo;Hello, world!&amp;rdquo;.bytes&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">channel</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Run consumer script in one terminal window</p>

<pre><code>$ chmod 755 consumer.groovy
$ ./consumer.groovy
</code></pre>

<p>and publisher script in another</p>

<pre><code>$ chmod 755 publisher.groovy
$ ./publisher.groovy
</code></pre>

<p>On the consumer window you should see <em>Received message: Hello, world!</em> text.</p>

<p>Now you just need to stop RabbitMQ server, and restart it in detached mode</p>

<pre><code>$ sudo -u rabbitmq rabbitmq-server -detached
</code></pre>
]]></content>
  </entry>
  
</feed>
